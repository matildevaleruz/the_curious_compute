{{ if .Site.Params.aside.showVisitorInfo | default true }}
{{ $visitorConfig := .Site.Params.aside.visitorInfo }}
{{ $enableBg := $visitorConfig.enableBackground | default false }}
{{ $bgImage := $visitorConfig.backgroundImage }}
{{ $bgColor := $visitorConfig.backgroundColor }}
{{ $bgSize := $visitorConfig.backgroundSize | default "cover" }}
{{ $bgPosition := $visitorConfig.backgroundPosition | default "center" }}
{{ $bgRepeat := $visitorConfig.backgroundRepeat | default "no-repeat" }}
{{ $textColor := $visitorConfig.textColor }}
{{ $textShadow := $visitorConfig.textShadow | default false }}
{{ $overlayColor := $visitorConfig.overlayColor }}
{{ $borderRadius := $visitorConfig.borderRadius }}

<section class="aside-card visitor-info-card{{ if $enableBg }} visitor-info-card-with-bg{{ end }}"
  {{ if $enableBg }}
  {{ $styleStr := "" }}
  {{ if $bgImage }}
    {{ $styleStr = printf "background-image: url('%s');" $bgImage }}
  {{ else if $bgColor }}
    {{ $styleStr = printf "background: %s;" $bgColor }}
  {{ end }}
  {{ if or $bgImage $bgColor }}
    {{ $styleStr = printf "%s background-size: %s; background-position: %s; background-repeat: %s;" $styleStr $bgSize $bgPosition $bgRepeat }}
  {{ end }}
  {{ if $borderRadius }}
    {{ $styleStr = printf "%s border-radius: %s;" $styleStr $borderRadius }}
  {{ end }}
  style="{{ $styleStr | safeCSS }}"
  {{ end }}
>
  {{ if and $enableBg $overlayColor }}
  <div class="visitor-info-card-overlay" style="background: {{ $overlayColor }};"></div>
  {{ end }}
  
  <div class="visitor-info-content"
    {{ if and $enableBg $textColor }}
    style="
      color: {{ $textColor }};
      {{ if $textShadow }}text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);{{ end }}
    "
    {{ end }}
  >
    <h3 class="aside-title">
      <i class="fas fa-globe"></i> {{ $visitorConfig.title | default "è®¿å®¢ä¿¡æ¯" }}
    </h3>
    <div class="visitor-info-body" id="visitorInfoMessage">
      <p class="visitor-loading">ğŸŒ å°ä¼™ä¼´ä½ å¥½å‘€ï¼ ğŸŒ</p>
      <p class="visitor-loading">æ­£åœ¨å¯»æ‰¾ä½ çš„è¶³è¿¹...</p>
    </div>
  </div>
  {{ if $visitorConfig.showFriendsLinks | default false }}
  <hr class="visitor-info-divider" />
  <div class="visitor-friends-links">
    <p class="visitor-friends-text">ğŸš‡ ç»§ç»­æ¢ç´¢æœªçŸ¥ ğŸ‘‡ï¸ğŸ‘‡ï¸ å‘ç°æ›´å¤šç²¾å½© ğŸš‡</p>
    {{ if $visitorConfig.travellingsLink | default true }}
    <a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener" title="å¼€å¾€-å‹é“¾æ¥åŠ›" aria-label="å¼€å¾€-å‹é“¾æ¥åŠ›" class="visitor-friends-link">
      <img src="https://www.travellings.cn/assets/logo.gif" alt="å¼€å¾€-å‹é“¾æ¥åŠ›" width="120" />
    </a>
    {{ end }}
    {{ if $visitorConfig.blogsClubLink | default true }}
    <a href="https://blogs.quest" target="_blank" rel="noopener" title="ç©ºé—´ç©¿æ¢­-éšæœºè®¿é—® BlogsClub æˆå‘˜åšå®¢" aria-label="ç©ºé—´ç©¿æ¢­-éšæœºè®¿é—® BlogsClub æˆå‘˜åšå®¢" class="visitor-friends-link">
      <img src="https://www.blogsclub.org/images/shuttle_4.png" alt="ç©ºé—´ç©¿æ¢­" />
    </a>
    {{ end }}
  </div>
  {{ end }}
</section>

{{/* ä¼ é€’APIé…ç½®åˆ°JavaScript */}}
<script>
  window.visitorInfoConfig = {
    enabled: {{ $visitorConfig.enabled | default true }},
    {{ if $visitorConfig.apiKey }}
    apiKey: '{{ $visitorConfig.apiKey }}',
    {{ end }}
    customLat: {{ $visitorConfig.customLat | default 0.0 }},
    customLng: {{ $visitorConfig.customLng | default 0.0 }},
    siteName: '{{ $visitorConfig.siteName | default "æœ¬ç«™" }}',
    fontColor: '{{ $visitorConfig.fontColor | default "deepskyblue" }}'
  };
</script>
{{ end }}

