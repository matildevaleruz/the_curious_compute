{{ $recentConfig := index .Site.Params.aside "recent-Posts" }}
{{ $enableBg := $recentConfig.enableBackground | default false }}
{{ $bgImage := $recentConfig.backgroundImage }}
{{ $bgColor := $recentConfig.backgroundColor }}
{{ $bgSize := $recentConfig.backgroundSize | default "cover" }}
{{ $bgPosition := $recentConfig.backgroundPosition | default "center" }}
{{ $bgRepeat := $recentConfig.backgroundRepeat | default "no-repeat" }}
{{ $textColor := $recentConfig.textColor }}
{{ $textShadow := $recentConfig.textShadow | default false }}
{{ $overlayColor := $recentConfig.overlayColor }}
{{ $borderRadius := $recentConfig.borderRadius }}

<section class="aside-card recent-posts-card{{ if $enableBg }} recent-posts-card-with-bg{{ end }}"
  {{ if $enableBg }}
  {{ $styleStr := "" }}
  {{ if $bgImage }}
    {{ $styleStr = printf "background-image: url('%s');" $bgImage }}
  {{ else if $bgColor }}
    {{ $styleStr = printf "background: %s;" $bgColor }}
  {{ end }}
  {{ if or $bgImage $bgColor }}
    {{ $styleStr = printf "%s background-size: %s; background-position: %s; background-repeat: %s;" $styleStr $bgSize $bgPosition $bgRepeat }}
  {{ end }}
  {{ if $borderRadius }}
    {{ $styleStr = printf "%s border-radius: %s;" $styleStr $borderRadius }}
  {{ end }}
  style="{{ $styleStr | safeCSS }}"
  {{ end }}
>
  {{ if and $enableBg $overlayColor }}
  <div class="recent-posts-card-overlay" style="background: {{ $overlayColor }};"></div>
  {{ end }}
  
  <div class="recent-posts-card-content"
    {{ if and $enableBg $textColor }}
    style="
      color: {{ $textColor }};
      {{ if $textShadow }}text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);{{ end }}
    "
    {{ end }}
  >
    <h3 class="aside-title"><i class="fas fa-clock"></i> 最新文章</h3>
    <div class="aside-recent">
        {{ range first 5 (where .Site.RegularPages "Type" "posts") }}
            {{ $defaultCover := $.Site.Params.images.defaultCover | default "/img/default-cover.jpg" }}
            {{ $fallbackImage := $.Site.Params.images.fallbackImage | default "/img/404.jpg" }}
            {{ $cover := .Params.cover | default $defaultCover }}
            <a class="recent-item" href="{{ .RelPermalink }}">
                <div class="recent-thumb">
                    <img src="{{ $cover | relURL }}" 
                         alt="{{ .Title }}" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='{{ $fallbackImage | relURL }}'">
                </div>
                <div class="recent-meta">
                    <div class="recent-title">{{ .Title }}</div>
                    <div class="recent-date">{{ .Date.Format "2006-01-02" }}</div>
                </div>
            </a>
        {{ end }}
    </div>
  </div>
</section>