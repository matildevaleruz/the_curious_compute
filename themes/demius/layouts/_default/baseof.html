<!DOCTYPE html>
<html lang="zh-CN" data-theme="{{ if site.Params.darkMode }}dark{{ else }}light{{ end }}"{{ if site.Params.grayscaleMode }} class="grayscale-mode"{{ end }}>
  <head>
    <meta charset="utf-8">
    <title>{{ block "title" . }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="author" content="{{ .Site.Params.author }}">
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    
    {{ with .Site.Params.images.favicon }}
    <link rel="icon" href="{{ . | relURL }}" type="image/x-icon">
    {{ end }}
    
    {{ with resources.Get "css/main.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ with resources.Get "css/_home-big-image.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ if site.Params.popup.enable }}
    {{ with resources.Get "css/_popup.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ end }}
    {{ if site.Params.linkCard.enable }}
    {{ with resources.Get "css/_link-card.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ end }}
    {{ if site.Params.grayscaleMode }}
    {{ with resources.Get "css/_grayscale.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ end }}
    {{ if site.Params.particleEffect.enable }}
    {{ with resources.Get "css/_particle-effect.css" | postCSS | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ end }}
    {{ end }}
    <link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css">
    
    {{/* è‡ªå®šä¹‰å­—ä½“åŠ è½½ */}}
    {{ if and .Site.Params.font.enable (eq .Site.Params.font.type "online") .Site.Params.font.onlineUrl }}
    {{ if hasPrefix .Site.Params.font.onlineUrl "https://fonts.googleapis.com" }}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    {{ end }}
    <link href="{{ .Site.Params.font.onlineUrl }}" rel="stylesheet">
    {{ end }}
    {{ if and .Site.Params.font.enable (eq .Site.Params.font.type "local") .Site.Params.font.localPath }}
    <style>
      @font-face {
        font-family: '{{ .Site.Params.font.localName }}';
        font-style: normal;
        font-display: swap;
        src: url('{{ .Site.Params.font.localPath }}') format('{{ if eq .Site.Params.font.localFormat "ttf" }}truetype{{ else }}{{ .Site.Params.font.localFormat }}{{ end }}');
      }
    </style>
    {{ end }}
    
    {{/* è¯„è®ºç³»ç»Ÿèµ„æºï¼ˆæå‰åŠ è½½ï¼Œç¡®ä¿PJAXåˆ‡æ¢æ—¶å¯ç”¨ï¼‰ */}}
    {{ if and site.Params.comment.enable (eq site.Params.comment.system "artalk") }}
      {{ if site.Params.comment.artalk.useLocal }}
        {{- $css := resources.Get "lib/artalk/Artalk.css" }}
        {{- $js := resources.Get "lib/artalk/Artalk.js" }}
        {{ if and $css $js }}
          <link rel="stylesheet" href="{{ $css.RelPermalink }}">
          <script defer src="{{ $js.RelPermalink }}"></script>
        {{ else }}
          <link rel="stylesheet" href="https://unpkg.com/artalk@2.8.5/dist/Artalk.css">
          <script defer src="https://unpkg.com/artalk@2.8.5/dist/Artalk.js"></script>
        {{ end }}
      {{ else }}
        {{ $cdn := index site.Params.comment.artalk.cdn (site.Params.comment.artalk.cdnIndex | default 0) }}
        <link rel="stylesheet" href="{{ $cdn.css }}">
        <script defer src="{{ $cdn.js }}"></script>
      {{ end }}
    {{ end }}
    
    {{/* Umamiç»Ÿè®¡è„šæœ¬ */}}
    {{ if and site.Params.analytics.umami.enable site.Params.analytics.umami.scriptUrl site.Params.analytics.umami.websiteId }}
    <script defer src="{{ site.Params.analytics.umami.scriptUrl }}" data-website-id="{{ site.Params.analytics.umami.websiteId }}"></script>
    {{ end }}
    
    {{/* APlayer å’Œ MetingJS (éŸ³ä¹æ’­æ”¾å™¨) - æ”¯æŒå¤‡ç”¨CDN */}}
    <script>
      // APlayer å’Œ MetingJS åŠ¨æ€åŠ è½½ï¼Œæ”¯æŒå¤‡ç”¨CDN
      (function() {
        const aplayerCSS = [
          'https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css',
          'https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css'
        ];
        
        const aplayerJS = [
          'https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js',
          'https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js'
        ];
        
        const metingCDNs = [
          'https://unpkg.com/meting@2/dist/Meting.min.js',
          'https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js'
        ];
        
        let cssIndex = 0;
        let jsIndex = 0;
        let metingIndex = 0;
        
        // åŠ è½½APlayer CSS
        function loadAPlayerCSS() {
          if (cssIndex >= aplayerCSS.length) {
            console.error('[éŸ³ä¹æ’­æ”¾å™¨] APlayer CSSæ‰€æœ‰CDNåŠ è½½å¤±è´¥');
            loadAPlayerJS(); // å³ä½¿CSSå¤±è´¥ä¹Ÿå°è¯•åŠ è½½JS
            return;
          }
          
          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = aplayerCSS[cssIndex];
          link.onerror = function() {
            cssIndex++;
            loadAPlayerCSS();
          };
          link.onload = function() {
            loadAPlayerJS();
          };
          document.head.appendChild(link);
        }
        
        // åŠ è½½APlayer JS
        function loadAPlayerJS() {
          if (jsIndex >= aplayerJS.length) {
            console.error('[éŸ³ä¹æ’­æ”¾å™¨] APlayer JSæ‰€æœ‰CDNåŠ è½½å¤±è´¥ï¼ŒéŸ³ä¹æ’­æ”¾å™¨å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œ');
            return;
          }
          
          const script = document.createElement('script');
          script.src = aplayerJS[jsIndex];
          script.onerror = function() {
            jsIndex++;
            loadAPlayerJS();
          };
          script.onload = function() {
            // APlayeråŠ è½½æˆåŠŸåï¼ŒåŠ è½½MetingJS
            loadMetingJS();
          };
          document.head.appendChild(script);
        }
        
        // åŠ è½½MetingJS
        function loadMetingJS() {
          if (metingIndex >= metingCDNs.length) {
            console.error('[éŸ³ä¹æ’­æ”¾å™¨] MetingJSæ‰€æœ‰CDNåŠ è½½å¤±è´¥');
            return;
          }
          
          const script = document.createElement('script');
          script.src = metingCDNs[metingIndex];
          script.onerror = function() {
            metingIndex++;
            loadMetingJS();
          };
          script.onload = function() {
            // åŠ è½½æˆåŠŸï¼Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶é€šçŸ¥
            window.dispatchEvent(new CustomEvent('metingjs:loaded'));
          };
          document.head.appendChild(script);
        }
        
        // å¼€å§‹åŠ è½½
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadAPlayerCSS);
        } else {
          loadAPlayerCSS();
        }
      })();
    </script>
    
    {{/* æ³¨å…¥ç«™ç‚¹é…ç½®åˆ°JavaScript */}}
    <script>
      window.siteConfig = {
        pjaxEnabled: '{{ .Site.Params.pjax }}',
        artalkServer: '{{ .Site.Params.comment.artalk.server }}',
        artalkSite: '{{ .Site.Params.comment.artalk.site }}',
        {{/* ç½®é¡¶å¾½ç« å›¾æ ‡å’Œæ–‡å­—é¢œè‰²é…ç½® */}}
        {{ with .Site.Params.pinned.iconColor }}
        pinnedIconColor: '{{ . }}',
        {{ end }}
        {{ with .Site.Params.pinned.textColor }}
        pinnedTextColor: '{{ . }}',
        {{ end }}
        {{ with .Site.Params.pinned.iconColorDark }}
        pinnedIconColorDark: '{{ . }}',
        {{ end }}
        {{ with .Site.Params.pinned.textColorDark }}
        pinnedTextColorDark: '{{ . }}',
        {{ end }}
        {{/* åŠ å¯†åŠŸèƒ½é…ç½® */}}
        encryption: {
          {{ with .Site.Params.encryption.fullHint }}
          fullHint: '{{ . }}',
          {{ end }}
          {{ with .Site.Params.encryption.partialHint }}
          partialHint: '{{ . }}',
          {{ end }}
          {{ with .Site.Params.encryption.wrongPasswordHint }}
          wrongPasswordHint: '{{ . }}',
          {{ end }}
          popupTextColor: '{{ .Site.Params.encryption.popupTextColor | default "" }}',
          popupBackgroundColor: '{{ .Site.Params.encryption.popupBackgroundColor | default "" }}',
          popupBackgroundImage: '{{ .Site.Params.encryption.popupBackgroundImage | default "" }}',
          partialPopupTextColor: '{{ .Site.Params.encryption.partialPopupTextColor | default "" }}',
          partialPopupBackgroundColor: '{{ .Site.Params.encryption.partialPopupBackgroundColor | default "" }}',
          partialPopupBackgroundImage: '{{ .Site.Params.encryption.partialPopupBackgroundImage | default "" }}'
        },
        {{/* å¼¹å¹•åŠŸèƒ½é…ç½® */}}
        danmaku: {
          enable: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "enable" }}{{ .Site.Params.danmaku.enable }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          scope: '{{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "scope" }}{{ .Site.Params.danmaku.scope }}{{ else }}all{{ end }}{{ else }}all{{ end }}',
          speed: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "speed" }}{{ .Site.Params.danmaku.speed }}{{ else }}3{{ end }}{{ else }}3{{ end }},
          fontSize: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "fontSize" }}{{ .Site.Params.danmaku.fontSize }}{{ else }}16{{ end }}{{ else }}16{{ end }},
          opacity: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "opacity" }}{{ .Site.Params.danmaku.opacity }}{{ else }}0.9{{ end }}{{ else }}0.9{{ end }},
          maxCount: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "maxCount" }}{{ .Site.Params.danmaku.maxCount }}{{ else }}50{{ end }}{{ else }}50{{ end }},
          updateInterval: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "updateInterval" }}{{ .Site.Params.danmaku.updateInterval }}{{ else }}30000{{ end }}{{ else }}30000{{ end }},
          showAvatar: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "showAvatar" }}{{ .Site.Params.danmaku.showAvatar }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          showTime: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "showTime" }}{{ .Site.Params.danmaku.showTime }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          loop: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "loop" }}{{ .Site.Params.danmaku.loop }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          randomPosition: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "randomPosition" }}{{ .Site.Params.danmaku.randomPosition }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          colorful: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "colorful" }}{{ .Site.Params.danmaku.colorful }}{{ else }}true{{ end }}{{ else }}true{{ end }},
          antiOverlap: {{ if isset .Site.Params "danmaku" }}{{ if isset .Site.Params.danmaku "antiOverlap" }}{{ .Site.Params.danmaku.antiOverlap }}{{ else }}true{{ end }}{{ else }}true{{ end }}
        },
        {{/* å½“å‰é¡µé¢ä¿¡æ¯ */}}
        currentPage: {
          url: '{{ .Permalink }}',
          title: '{{ .Title }}',
          type: '{{ .Type }}',
          kind: '{{ .Kind }}'
        }
      };
      
      // ç«‹å³è®¾ç½®ç½®é¡¶å¾½ç« CSSå˜é‡
      (function() {
        {{ with .Site.Params.pinned.iconColor }}
        document.documentElement.style.setProperty('--pinned-icon-color', '{{ . }}');
        {{ end }}
        {{ with .Site.Params.pinned.textColor }}
        document.documentElement.style.setProperty('--pinned-text-color', '{{ . }}');
        {{ end }}
        {{ with .Site.Params.pinned.iconColorDark }}
        document.documentElement.style.setProperty('--pinned-icon-color-dark', '{{ . }}');
        {{ end }}
        {{ with .Site.Params.pinned.textColorDark }}
        document.documentElement.style.setProperty('--pinned-text-color-dark', '{{ . }}');
        {{ end }}
      })();
    </script>
    
    {{ block "head" . }}{{ end }}
  </head>
  
<body{{ if .IsHome }} class="home"{{ else if .IsPage }}{{ if eq .Type "posts" }} class="single-post"{{ end }}{{ end }}>
  {{ partial "header/header.html" . }}
  
  {{/* é¡¶éƒ¨å…¬å‘Šæ ç»„ä»¶ */}}
  {{ if .Site.Params.topAnnouncement.enable }}
    {{ partial "components/top-announcement.html" . }}
  {{ end }}

  <!-- ç»Ÿä¸€éª¨æ¶ï¼šå·¦å³ä¾§æ  + ä¸­é—´å†…å®¹ã€‚æ‰€æœ‰é¡µé¢åªéœ€å®šä¹‰ block "content" -->
  <div class="site-wrap">
    {{ if .Site.Params.aside.left }}
      <aside class="site-aside-left{{ if .Site.Params.aside.unifiedMode }} aside-unified{{ end }}{{ if .Site.Params.aside.transparentMode }} aside-transparent{{ end }}">
        {{ $currentPage := . }}
        {{ range .Site.Params.aside.left }}
          {{ if or (eq . "toc") (eq . "related-Posts") }}
            {{ partial (printf "aside/widgets/%s.html" .) $currentPage }}
          {{ else }}
            {{ partialCached (printf "aside/widgets/%s.html" .) $ }}
          {{ end }}
        {{ end }}
      </aside>
    {{ end }}

    <main class="site-main">
      {{/* è½®æ’­å›¾ç»„ä»¶ - åœ¨ä¸»å†…å®¹åŒºåŸŸå¼€å¤´ */}}
      {{ partial "components/carousel.html" . }}
      
      {{ block "content" . }}{{ end }}
    </main>

    {{ if .Site.Params.aside.right }}
      <aside class="site-aside-right{{ if .Site.Params.aside.unifiedMode }} aside-unified{{ end }}{{ if .Site.Params.aside.transparentMode }} aside-transparent{{ end }}">
        {{ $currentPage := . }}
        {{ range .Site.Params.aside.right }}
          {{ if or (eq . "toc") (eq . "related-Posts") }}
            {{ partial (printf "aside/widgets/%s.html" .) $currentPage }}
          {{ else }}
            {{ partialCached (printf "aside/widgets/%s.html" .) $ }}
          {{ end }}
        {{ end }}
      </aside>
    {{ end }}
  </div>

  {{ partial "footer/footer.html" . }}
  {{ partial "components/float-buttons.html" . }}
  {{ partial "components/search-modal.html" . }}
  {{ partial "components/music-player-float.html" . }}
  
  {{/* å¼€å‘è€…å·¥å…·é˜²æŠ¤é…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼Œå¿…é¡»åœ¨å…¶ä»–è„šæœ¬ä¹‹å‰åŠ è½½ï¼‰ */}}
  {{ if .Site.Params.devToolsProtection.enabled }}
  <script>
    window.devToolsProtectionConfig = {
      enabled: {{ .Site.Params.devToolsProtection.enabled | default false }},
      disableRightClick: {{ .Site.Params.devToolsProtection.disableRightClick | default true }},
      disableTextSelection: {{ .Site.Params.devToolsProtection.disableTextSelection | default false }},
      detectDevTools: {{ .Site.Params.devToolsProtection.detectDevTools | default true }},
      devToolsThreshold: {{ .Site.Params.devToolsProtection.devToolsThreshold | default 160 }},
      disableConsole: {{ .Site.Params.devToolsProtection.disableConsole | default false }},
      disableDebugger: {{ .Site.Params.devToolsProtection.disableDebugger | default false }},
      preventIframe: {{ .Site.Params.devToolsProtection.preventIframe | default true }},
      onDevToolsOpen: {{ .Site.Params.devToolsProtection.onDevToolsOpen | default "none" | jsonify }},
      redirectUrl: {{ .Site.Params.devToolsProtection.redirectUrl | default "/" | jsonify }}
    };
  </script>
  {{ with resources.Get "js/_devtools-protection.js" | js.Build | minify | fingerprint }}
    <script src="{{ .RelPermalink }}"></script>
  {{ end }}
  {{ end }}
  
  {{ with resources.Get "js/main.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{ with resources.Get "js/_home-big-image.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{ with resources.Get "js/_background.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{ with resources.Get "js/_post-views.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{ with resources.Get "js/_post-reading-time.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{/* é¡¶éƒ¨å…¬å‘Šæ è„šæœ¬ */}}
  {{ if .Site.Params.topAnnouncement.enable }}
  {{ with resources.Get "js/_top-announcement.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  {{ end }}
  
  {{ if .Site.Params.pjax }}
  {{ with resources.Get "js/_simple-pjax.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  {{ end }}
  
  {{/* ç½‘å‹åœˆè„šæœ¬ï¼ˆå…¨å±€åŠ è½½ï¼Œç¡®ä¿PJAXåˆ‡æ¢æ—¶å¯è°ƒç”¨ï¼‰ */}}
  {{ with resources.Get "js/_friends-circle.js" | js.Build | minify | fingerprint }}
    <script defer src="{{ .RelPermalink }}"></script>
  {{ end }}
  
  {{/* è¯„è®ºç³»ç»Ÿé¦–æ¬¡åˆå§‹åŒ–è„šæœ¬ï¼ˆéPJAXç¯å¢ƒï¼‰ */}}
  {{ if and site.Params.comment.enable (eq site.Params.comment.system "artalk") }}
  <script>
    // é¦–æ¬¡åŠ è½½æ—¶åˆå§‹åŒ–è¯„è®ºï¼ˆä»…åœ¨éPJAXæˆ–ç›´æ¥è®¿é—®æ—¶ï¼‰
    document.addEventListener('DOMContentLoaded', function() {
      const commentEl = document.getElementById('artalk-comment');
      if (!commentEl || typeof Artalk === 'undefined') {
        return;
      }
      
      try {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const isDarkMode = currentTheme === 'dark';
        
        const artalkInstance = Artalk.init({
          el: '#artalk-comment',
          pageKey: window.location.pathname,
          pageTitle: document.title,
          server: '{{ site.Params.comment.artalk.server }}',
          site: '{{ site.Params.comment.artalk.site }}',
          placeholder: '{{ site.Params.comment.artalk.placeholder }}',
          darkMode: isDarkMode,
          locale: '{{ site.Params.comment.artalk.locale }}',
          gravatar: { params: '{{ site.Params.comment.artalk.gravatar }}' },
          pagination: { pageSize: {{ site.Params.comment.artalk.pageSize }} },
          emoticons: {{ site.Params.comment.artalk.emoticons }},
          heightLimit: {{ site.Params.comment.artalk.heightLimit }}
        });
        
        // ç›‘å¬ä¸»é¢˜å˜åŒ–
        const observer = new MutationObserver(() => {
          const newTheme = document.documentElement.getAttribute('data-theme');
          const newDarkMode = newTheme === 'dark';
          try {
            artalkInstance.setDarkMode(newDarkMode);
          } catch (err) {
            // åŒæ­¥Artalkä¸»é¢˜æ—¶å‡ºç°å¼‚å¸¸ï¼Œé™é»˜å¤„ç†
          }
        });
        
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['data-theme']
        });
      } catch (error) {
        console.error('è¯„è®ºç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
      }
    });
  </script>
  {{ end }}
  
  <!-- èƒŒæ™¯å›¾é…ç½® -->
  <script>
        // åˆå¹¶é…ç½®ï¼Œè€Œä¸æ˜¯è¦†ç›–ï¼ˆä¿ç•™ç¬¬ä¸€æ¬¡å®šä¹‰çš„åŠ å¯†é…ç½®ï¼‰
        if (!window.siteConfig) {
          window.siteConfig = {};
        }
        Object.assign(window.siteConfig, {
          siteBackgroundEnabled: '{{ .Site.Params.background.site.enable | default "true" }}',
          siteBackgroundImage: '{{ .Site.Params.background.site.image }}',
          siteBackgroundBlur: '{{ .Site.Params.background.site.blur | default "0" }}',
          siteBackgroundBrightness: '{{ .Site.Params.background.site.brightness | default "100" }}',
          siteBackgroundOpacity: '{{ .Site.Params.background.site.opacity | default "80" }}',
          {{/* æ‰‹æœºç«¯ç›®å½•æŒ‰é’®å¼¹å‡ºæ¨¡å¼é…ç½® */}}
          mobileTocPopupMode: '{{ .Site.Params.aside.toc.mobilePopupMode | default "sidebar" }}',
          effectMode: '{{ .Site.Params.background.effect_mode | default "glass" }}',
          solidColor: '{{ .Site.Params.background.solid_color | default "#4fc3f7" }}',
          // æ–°å¢ä¸»é¡µå¤§å›¾é…ç½®
          homeBigImageEnabled: '{{ .Site.Params.homeBigImage.enable | default "false" }}',
          homeBigImageMode: '{{ .Site.Params.homeBigImage.mode | default "mode1" }}',
          homeBigImageTitle: '{{ .Site.Params.homeBigImage.title }}',
          homeBigImageSubtitle: '{{ .Site.Params.homeBigImage.subtitle }}',
          homeBigImageMode1BackgroundImage: '{{ .Site.Params.homeBigImage.mode1.backgroundImage }}',
          homeBigImageMode1ArrowAnimation: '{{ .Site.Params.homeBigImage.mode1.arrowAnimation | default "false" }}',
          homeBigImageMode1ScrollSpeed: '{{ .Site.Params.homeBigImage.mode1.scrollSpeed | default "500" }}',
          homeBigImageMode1CardAnimation: '{{ .Site.Params.homeBigImage.mode1.cardAnimation | default "true" }}',
          homeBigImageMode1CardAnimationSpeed: '{{ .Site.Params.homeBigImage.mode1.cardAnimationSpeed | default "normal" }}',
          homeBigImageMode2FullScreen: '{{ .Site.Params.homeBigImage.mode2.fullScreen | default "true" }}',
          homeBigImageMode2OverlayOpacity: '{{ .Site.Params.homeBigImage.mode2.overlayOpacity | default "0.3" }}',
          homeBigImageMode2CustomBackgroundImage: '{{ .Site.Params.homeBigImage.mode2.customBackgroundImage }}',
          // æ‰“å­—æœºæ•ˆæœé…ç½®
          typewriterEnable: '{{ .Site.Params.homeBigImage.mode2.typewriterEnable | default "false" }}',
          typewriterSpeed: '{{ .Site.Params.homeBigImage.mode2.typewriterSpeed | default "100" }}',
          typewriterDelay: '{{ .Site.Params.homeBigImage.mode2.typewriterDelay | default "1000" }}',
          typewriterCursor: '{{ .Site.Params.homeBigImage.mode2.typewriterCursor | default "true" }}',
          typewriterLoop: '{{ .Site.Params.homeBigImage.mode2.typewriterLoop | default "false" }}',
          // æ— åˆ·æ–°åˆ‡æ¢é…ç½®ï¼ˆå¦‚æœç¬¬ä¸€æ¬¡å®šä¹‰ä¸­å·²å­˜åœ¨ï¼Œè¿™é‡Œä¼šè¦†ç›–ï¼‰
          pjaxEnabled: '{{ .Site.Params.pjax | default "false" }}',
          // Artalkè¯„è®ºç³»ç»Ÿé…ç½®ï¼ˆå¦‚æœç¬¬ä¸€æ¬¡å®šä¹‰ä¸­å·²å­˜åœ¨ï¼Œè¿™é‡Œä¼šè¦†ç›–ï¼‰
          artalkServer: '{{ .Site.Params.comment.artalk.server | default "https://site.demius.tech" }}',
          artalkSite: '{{ .Site.Params.comment.artalk.site | default "demius" }}',
          // Umamiç»Ÿè®¡é…ç½®ï¼ˆæ–‡ç« æµè§ˆé‡ï¼‰
          umamiApiUrl: '{{ .Site.Params.analytics.umami.apiUrl | default "" }}',
          umamiUseForPostViews: {{ if .Site.Params.analytics.umami.useForPostViews }}{{ .Site.Params.analytics.umami.useForPostViews }}{{ else }}true{{ end }},
          // ç²’å­ç‰¹æ•ˆé…ç½®
          particleEffectEnable: '{{ .Site.Params.particleEffect.enable | default "false" }}',
          particleEffectCount: '{{ .Site.Params.particleEffect.count | default "80" }}',
          particleEffectColor: '{{ .Site.Params.particleEffect.color | default "" }}',
          particleEffectLineColor: '{{ .Site.Params.particleEffect.lineColor | default "" }}',
          particleEffectLineDistance: '{{ .Site.Params.particleEffect.lineDistance | default "150" }}',
          particleEffectSpeed: '{{ .Site.Params.particleEffect.speed | default "0.5" }}',
          particleEffectRadius: '{{ .Site.Params.particleEffect.radius | default "1.5" }}',
          particleEffectInteractive: '{{ .Site.Params.particleEffect.interactive | default "true" }}',
          particleEffectZIndex: '{{ .Site.Params.particleEffect.zIndex | default "0" }}',
          umamiWebsiteId: '{{ .Site.Params.analytics.umami.websiteId | default "" }}',
          // å¯¼èˆªæ å›ºå®šé…ç½®
          stickyHeader: {{ .Site.Params.stickyHeader | default false }},
          // ä¾§æ å®½åº¦æ¨¡å¼é…ç½®
          asideWideMode: {{ if .Site.Params.aside.wideMode }}{{ if eq (printf "%T" .Site.Params.aside.wideMode) "string" }}'{{ .Site.Params.aside.wideMode }}'{{ else }}{{ .Site.Params.aside.wideMode }}{{ end }}{{ else }}false{{ end }},
          // å­—ä½“é…ç½®
          fontEnable: {{ .Site.Params.font.enable | default false }},
          fontType: '{{ .Site.Params.font.type | default "online" }}',
          fontOnlineUrl: '{{ .Site.Params.font.onlineUrl | default "" }}',
          fontFamily: '{{ .Site.Params.font.fontFamily | default "" }}',
          fontLocalName: '{{ .Site.Params.font.localName | default "" }}',
          fontLocalPath: '{{ .Site.Params.font.localPath | default "" }}',
          fontLocalFormat: '{{ .Site.Params.font.localFormat | default "woff2" }}',
          // é¡¶éƒ¨å…¬å‘Šæ é…ç½®
          topAnnouncement: {
            enable: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "enable" }}{{ .Site.Params.topAnnouncement.enable }}{{ else }}false{{ end }}{{ else }}false{{ end }},
            mode: '{{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "mode" }}{{ .Site.Params.topAnnouncement.mode }}{{ else }}custom{{ end }}{{ else }}custom{{ end }}',
            height: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "height" }}{{ .Site.Params.topAnnouncement.height }}{{ else }}40{{ end }}{{ else }}40{{ end }},
            shuoshuo: {
              apiUrl: '{{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "apiUrl" }}{{ .Site.Params.topAnnouncement.shuoshuo.apiUrl }}{{ else }}{{ end }}{{ else }}{{ end }}{{ else }}{{ end }}',
              count: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "count" }}{{ .Site.Params.topAnnouncement.shuoshuo.count }}{{ else }}3{{ end }}{{ else }}3{{ end }}{{ else }}3{{ end }},
              interval: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "interval" }}{{ .Site.Params.topAnnouncement.shuoshuo.interval }}{{ else }}5000{{ end }}{{ else }}5000{{ end }}{{ else }}5000{{ end }},
              transitionDuration: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "transitionDuration" }}{{ .Site.Params.topAnnouncement.shuoshuo.transitionDuration }}{{ else }}500{{ end }}{{ else }}500{{ end }}{{ else }}500{{ end }},
              showAvatar: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "showAvatar" }}{{ .Site.Params.topAnnouncement.shuoshuo.showAvatar }}{{ else }}true{{ end }}{{ else }}true{{ end }}{{ else }}true{{ end }},
              showTime: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "showTime" }}{{ .Site.Params.topAnnouncement.shuoshuo.showTime }}{{ else }}true{{ end }}{{ else }}true{{ end }}{{ else }}true{{ end }},
              cacheDuration: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "cacheDuration" }}{{ .Site.Params.topAnnouncement.shuoshuo.cacheDuration }}{{ else }}1800000{{ end }}{{ else }}1800000{{ end }}{{ else }}1800000{{ end }},
              clickable: {{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "clickable" }}{{ .Site.Params.topAnnouncement.shuoshuo.clickable }}{{ else }}true{{ end }}{{ else }}true{{ end }}{{ else }}true{{ end }},
              shuoshuoPageUrl: '{{ if isset .Site.Params "topAnnouncement" }}{{ if isset .Site.Params.topAnnouncement "shuoshuo" }}{{ if isset .Site.Params.topAnnouncement.shuoshuo "shuoshuoPageUrl" }}{{ .Site.Params.topAnnouncement.shuoshuo.shuoshuoPageUrl }}{{ else }}/shuoshuo/{{ end }}{{ else }}/shuoshuo/{{ end }}{{ else }}/shuoshuo/{{ end }}'
            }
          },
          // é“¾æ¥å¡ç‰‡å’Œè·³è½¬ä¸­è½¬é…ç½®
          linkCard: {
            enable: {{ .Site.Params.linkCard.enable | default false }},
            cardMode: '{{ .Site.Params.linkCard.cardMode | default "external" }}',
            openInNewTab: {{ .Site.Params.linkCard.openInNewTab | default true }},
            showArticleInfo: {{ .Site.Params.linkCard.showArticleInfo | default true }},
            showArticleTitle: {{ .Site.Params.linkCard.showArticleTitle | default true }},
            showArticleDate: {{ .Site.Params.linkCard.showArticleDate | default true }},
            showArticleSummary: {{ .Site.Params.linkCard.showArticleSummary | default true }},
            redirectPage: {{ .Site.Params.linkCard.redirectPage | default true }},
            replaceWhitelist: {{ .Site.Params.linkCard.replaceWhitelist | default (slice) | jsonify }},
            pageWhitelist: {{ .Site.Params.linkCard.pageWhitelist | default (slice) | jsonify }},
            elementWhitelist: {{ .Site.Params.linkCard.elementWhitelist | default (slice) | jsonify }},
            redirectWhitelist: {{ .Site.Params.linkCard.redirectWhitelist | default (slice) | jsonify }},
            redirect: {
              pagePath: '{{ .Site.Params.linkCard.redirect.pagePath | default "/go.html" }}',
              countdown: {{ .Site.Params.linkCard.redirect.countdown | default 3 }},
              showCountdown: {{ .Site.Params.linkCard.redirect.showCountdown | default true }},
              showButton: {{ .Site.Params.linkCard.redirect.showButton | default true }},
              safeMessage: '{{ .Site.Params.linkCard.redirect.safeMessage | default "ğŸ˜ƒ æ¥è‡ªæœ¬ç«™ï¼Œæœ¬ç«™å¯ç¡®ä¿å…¶å®‰å…¨æ€§ï¼Œè¯·æ”¾å¿ƒç‚¹å‡»è·³è½¬" }}'
            }
          }
        });
        
        // è®¾ç½®ä¾§æ å®½åº¦CSSå˜é‡çš„å…¨å±€å‡½æ•°
        window.setAsideWidth = function() {
          if (!window.siteConfig) return;
          
          const mode = window.siteConfig.asideWideMode;
          let asideWidth = '260px'; // é»˜è®¤å®½åº¦
          
          // å°†æ¨¡å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶å»é™¤å¼•å·ï¼ˆå¤„ç†Hugoæ¨¡æ¿å¯èƒ½æ·»åŠ çš„å¼•å·ï¼‰
          const modeStr = String(mode).replace(/^["']|["']$/g, '').toLowerCase();
          
          // æ”¯æŒå¤šç§é…ç½®æ–¹å¼ï¼šå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼
          if (mode === true || modeStr === 'true' || modeStr === 'wide') {
            asideWidth = '415px'; // è¶…å®½æ¨¡å¼
          } else if (modeStr === 'medium') {
            asideWidth = '332px'; // ä¸­å®½æ¨¡å¼
          } else {
            // é»˜è®¤æ¨¡å¼ï¼šfalse, 'false', 'normal', 'default' æˆ–æœªå®šä¹‰
            asideWidth = '260px';
          }
          
          document.documentElement.style.setProperty('--aside-width', asideWidth);
        };
        
        // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        window.setAsideWidth();
        
        // è®¾ç½®å…¨ç«™å­—ä½“çš„å…¨å±€å‡½æ•°
        window.setFontFamily = function() {
          if (!window.siteConfig) {
            console.warn('setFontFamily: siteConfig not found');
            return;
          }
          
          // æ£€æŸ¥æ˜¯å¦å¯ç”¨å­—ä½“
          const fontEnable = window.siteConfig.fontEnable === true || 
                            window.siteConfig.fontEnable === 'true' || 
                            String(window.siteConfig.fontEnable).toLowerCase() === 'true';
          
          if (!fontEnable) {
            // æœªå¯ç”¨è‡ªå®šä¹‰å­—ä½“ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“
            document.documentElement.style.setProperty('--font-family', '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif');
            return;
          }
          
          const fontType = String(window.siteConfig.fontType || 'online').toLowerCase();
          let fontFamily = '';
          
          if (fontType === 'local') {
            // æœ¬åœ°å­—ä½“
            const localName = String(window.siteConfig.fontLocalName || '').trim();
            if (localName) {
              // å»é™¤å¯èƒ½çš„å¼•å·
              const cleanName = localName.replace(/^["']|["']$/g, '');
              fontFamily = `'${cleanName}', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif`;
            }
          } else {
            // åœ¨çº¿å­—ä½“
            const onlineFontFamily = String(window.siteConfig.fontFamily || '').trim();
            if (onlineFontFamily) {
              // å»é™¤å¯èƒ½çš„å¼•å·
              const cleanFamily = onlineFontFamily.replace(/^["']|["']$/g, '');
              fontFamily = `${cleanFamily}, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif`;
            }
          }
          
          if (fontFamily) {
            document.documentElement.style.setProperty('--font-family', fontFamily);
            // ç¡®ä¿ body ä¹Ÿåº”ç”¨å­—ä½“ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
            document.body.style.fontFamily = fontFamily;
          }
        };
        
        // ç­‰å¾… DOM åŠ è½½å®Œæˆåå†æ‰§è¡Œ
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', window.setFontFamily);
        } else {
          // DOM å·²ç»åŠ è½½å®Œæˆï¼Œç«‹å³æ‰§è¡Œ
          window.setFontFamily();
        }
  </script>
  {{ partial "artalk-global.html" . }}
  
  {{/* å¼¹çª—å…¬å‘Šç»„ä»¶ */}}
  {{ if site.Params.popup.enable }}
    {{ partial "components/popup.html" . }}
    {{ with resources.Get "js/_popup.js" | minify | fingerprint }}
      <script src="{{ .RelPermalink }}"></script>
    {{ end }}
  {{ end }}
  
  {{/* é“¾æ¥å¡ç‰‡å’Œè·³è½¬ä¸­è½¬åŠŸèƒ½ */}}
  {{ if or site.Params.linkCard.enable site.Params.linkCard.redirectPage }}
    {{ with resources.Get "js/_link-card.js" | minify | fingerprint }}
      <script src="{{ .RelPermalink }}"></script>
    {{ end }}
  {{ end }}
</body>
</html>